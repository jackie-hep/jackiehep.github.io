---
layout:     post
title:         Docker在工程上的应用
subtitle:   概念到具体操作的澄清
date:       2020-03-11
author:     PengHe
header-img: img/post-bg-ios9-web.jpg
catalog: true
categories: Tech
tags:
    - Docker    
---

# Docker在工程上的使用

### Docker概念

Docker是容器的一种，容器是一种轻量级的虚拟技术，和其对应的虚机技术则更为重量，两者之间的区别不再赘述。容器是一种基于操作系统的虚拟技术，运行于操作系统上的用户空间，所有的容器都共用一个系统内核，甚至是公共库，容器引擎提供进程级别的隔离，让每个容器都像运行在单独的系统之上，但又能共享很多底层资源。

#### Docker的组件

Docker Client：Docker提供给用户的客户端。
Docker Daemon：Docker服务的守护进程。Docker Daemon接收Docker Client发来的指令，并对服务器进行具体操作。
Docker Image：Docker镜像程序，是一个只读的静态模板，保存着容器需要的环境和应用的执行代码。
Docker Registry：Docker Image的仓库，用来管理Docker镜像，提供镜像的上传，下载，浏览等管理操作。
Docker Container:Docker容器，是跑Docker镜像，提供服务的场所。Docker Container提供了系统硬件环境，使用Docker Image制作的系统盘，再加上项目代码，运行起来对外提供服务，是个执行时的环境。

![](data:image/png;base64,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)



	镜像的层次结构如下：bootfs上层的镜像称为根镜像，通常情况下它是一个操作系统。用户的镜像必须构建于根镜像之上。镜像之间是可以叠加的。
	通过 $ docker images 可以查看本物理机上的所有镜像。
	创建本地镜像有两种方式：
	A.用Commit创建本地镜像
	例子如下：
		在ubuntu镜像上创建和运行一个容器，并在该容器上安装SQLite3，将这个修改提交到本地库中，生成新的镜像。
		$ docker run -t -i ubuntu
		root@12344321(container-id)：/#apt-get update
		root@12344321(container-id)：/#apt-get install sqlite3
		root@12344321(container-id)：/#exit 
		# docker commit -m="Mesasge" --author="PENGHE" 12344321 HUBname/sqlite3:tagv1
		# docker run -t -it HUBName/sqlite3:tag1
	B.使用Dockerfile创建镜像
		这种方法是将对镜像的全部操作写入到一个文件中，然后使用docker builder命令中这个文件创建镜像。

![](https://www.kubernetes.org.cn/img/2020/03/filesystem.jpg)

#### 容器的管理操作

	容器的常见命令（包含查看、创建、启动、终止和删除等）：
	$ sudo docker run -i -t --name=inspect_shell ubuntu /bin/bash 诸如此类.
	容器的创建和运行在后台会发生什么呢？Docker首先在本地搜索我们制定的ubuntu镜像，如果没有找到，就会到公共仓库Docker Hub中继续搜索。如果在服务器上找到了镜像，Docker就会下载这个镜像，并将其保存在本地。然后，Docker使用这个镜像创建一个新的容器并将其启动。接着会分配容器的网络，Docker会为容器分配一个虚拟网络接口，并通过网桥的方式将该网络接口桥接到宿主主机上去，然后该虚拟网络接口分配一个IP地址。
	$ sudo ducker ps ... etc.

#### Docker的使用例子

设想一个如下场景：我们需要一个webapp，其功能是用户注册并将注册信息插入到数据库，环境为Ubuntu+Tomcat+Mysql,怎么做？不使用Docker的话，我们通常会这样做，以Ubuntu为操作系统，然后安装Tomcat和MySQL，最后把app部署上就可以了。那么使用Docker会怎么做呢，在这个场景下，可以有两种方式：
1.仍然以Ubuntu为操作系统，然后构建一个安装有MySQL和Tomcat的Docker镜像，并把app部署到其中，最后启动Docker镜像就可以了。看起来好像和不使用Docker基本相同，甚至还要麻烦一些，是这样吗？别着急，继续往下看。
2.第二种方式则体现了Docker的"每个容器只做一件事情"的思想，我们构建两个镜像，一个仅安装Tomcat并部署我们的app，另一个仅安装MySQL，然后启动这两个镜像，得到两个容器，再利用Docker的容器互联技术将二者连接(Docker的容器是通过http连接的)。

#### Docker带来的好处

1.保证了线上线下环境的一致性我们在线下的开发环境使用Docker构建好weaapp的镜像后，可以直接在线上使用一个镜像，保证了线上线下环境的一致性，再也不会有在线下开发环境中运行正常，而部署到线上各种错误了。
2.极大的简化了webapp的部署流程在不使用Docker时，我们部署app时，要先搭建好app运行所需环境，这个过程做过的人都知道多么枯燥繁琐，一不小心还出错。而有了Docker，我们只需要直接构建一个我们webapp的镜像然后将其运行即可，无论在多少台服务器中部署，都是如此。再比如，使用Docker之前要搭建一个WordPress对于新手来说是有些困难的，而有了Docker，只需要从Docker Hub上pull一个WordPress镜像并启动就可以了，非常方便。
3.实现了沙盒机制，提高了安全性由于webapp运行在容器中，与操作系统隔离开了，从而使操作系统基本不可能受到破坏，另外如果webapp因为攻击而瘫痪，并不需要重启服务器，直接重启容器或者再启动一个镜像就可以了。
4.实现了模块化，提高了复用性。在使用Docker的第二种方式就可以看出，我们将数据库和Tomcat运行在不同的容器中，从某种角度来说，这也降低了模块之间的耦合性，便于拓展。比如我们要把MySQL替换为oracle，只需要再构建一个oracle镜像并启动与Tomcat连接即可，非常方便。对于我们构建的镜像，在其他app中直接拿来用就可以了，不必重复劳动。
5.实现了虚拟化，提高硬件利用率。有了Docker，我们可以在一台服务器上运行很多webapp，充分利用闲置资源。这时候，服务器的操作系统就类似于货轮，而一个个Docker容器就相当于货轮上的一个个集装箱。举个例子来说，现在我们有一台操作系统为Ubuntu14.04的服务器，我们构建不同版本的ubuntu镜像并启动，并且为不同的用户分配不同的容器。这样，用一台服务器可以虚拟出n个运行着不同操作系统的虚拟服务器，而对于用户来说，这些是透明的––用户则认为自己拥有一台完整的服务器。阿里云的服务器就是这么干的。这充分利用了闲置的硬件资源。

### 	综述

容器充分的使用了系统资源并简化了操作，相比虚拟机技术有了本质上的飞跃，在工程应用中得到了广泛的应用。
